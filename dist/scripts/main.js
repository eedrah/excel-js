"use strict";function TableBuilder(t){this.$table=t}function DataBinder(){this.cells=[]}function Cell(t,e,i){this.row=t,this.column=e,this.notificationCallback=i,this.fnToOtherCells=dataBinder.getCellAt.bind(dataBinder),this._formula="",this._value=""}function FormulaParser(t){this.fnToOtherCells=t,this.isValid=!1,this.value=null}var ReferenceHelper=function(){function t(i){if(0===i)return"";var a=i-1,n=e[a%e.length],l=Math.floor(a/26),r=t(l);return r+n}var e="ABCDEFGHIJKLMNOPQRSTUVWXYZ";return{NumericToAlpha:t}}();TableBuilder.prototype={build:function(){this.addHeaderRow(),this.addDataRows()},addHeaderRow:function(){var t=$("<tr>");t.append($("<th>"));for(var e=1;100>=e;e++)this.addColumnHeaderCell(t,e);this.$table.append(t)},addColumnHeaderCell:function(t,e){var i=ReferenceHelper.NumericToAlpha(e),a=$("<th>");a.text(i),t.append(a)},addDataRows:function(){for(var t=1;100>=t;t++)this.addDataRow(t)},addDataRow:function(t){var e=$("<tr>"),i=$("<th>").text(t);e.append(i);for(var a=1;100>=a;a++){var n=$("<td>").append($('<input type="text">'));e.append(n)}this.$table.append(e)}},DataBinder.prototype={initialize:function(t){var e=100,i=100;this.$table=t,this.inputs=t.find("input"),this._initializeCellsArray(e,i),this._bindInputsToArray(),this._bindRefreshButton()},_initializeCellsArray:function(t,e){for(var i=0;t>i;i++){for(var a=[],n=0;e>n;n++){var l=this.createNotificationCallback(i,n);a.push(new Cell(i,n,l))}this.cells.push(a)}},_bindInputsToArray:function(){this.inputs.change(this,function(t){var e=t.data,i=$(this),a=i.closest("tr").index(),n=i.closest("td").index();e.cells[a][n].notifyInputChange(i.val())})},_bindRefreshButton:function(){$("#refreshTable").click(this.refreshAllCells.bind(this))},refreshAllCells:function(){this.inputs.val(""),this.cells.forEach(function(t){t.forEach(function(t){t.broadcastValue()})})},createNotificationCallback:function(t,e){return function(i){this._notifyCellChange(t,e,i)}.bind(this)},_notifyCellChange:function(t,e,i){this.inputs.eq(100*(t-1)+e-1).val(i)},getCellAt:function(t,e){return this.cells[t-1][e-1]}},Cell.prototype={notifyInputChange:function(t){"="===t[0]?this.setFormula(t.slice(1)):this.setValue(t)},setValue:function(t){t!==this._value&&(this._value=t,this.broadcastValue())},broadcastValue:function(){this.notificationCallback(this._value)},setFormula:function(t){var e=new FormulaParser(this.fnToOtherCells);e.parse(t),this.setValue(e.isValid?e.value:"#Error")}},FormulaParser.prototype={parse:function(t){t=this._replaceCellReferences(t),this._compute(t)},_compute:function(t){try{var e=math.eval(t);this.isValid=!0,this.value=e}catch(i){}},_replaceCellReferences:function(t){return t}};var dataBinder=new DataBinder;$(function(){var t=$("table");new TableBuilder(t).build(),dataBinder.initialize(t)});